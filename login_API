from fastapi import FastAPI, Form
from fastapi.middleware.cors import CORSMiddleware
from pydantic import BaseModel

app = FastAPI()

# Flutter 연동 위해 CORS 설정
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

# 닉네임 저장용 리스트
logged_in_users = []

# 로그인 요청을 받을 모델
class LoginRequest(BaseModel):
    nickname: str

@app.post("/login")
def login(request: LoginRequest):
    nickname = request.nickname.strip()

    if not nickname:
        return {"success": False, "message": "닉네임이 비어 있습니다."}

    if nickname not in logged_in_users:
        logged_in_users.append(nickname)
        return {"success": True, "message": f"{nickname}님 로그인 성공", "nickname": nickname}
    else:
        return {"success": True, "message": f"{nickname}님 이미 로그인되어 있습니다.", "nickname": nickname}

@app.get("/logged_users")
def get_logged_users():
    return {"logged_in_users": logged_in_users}
